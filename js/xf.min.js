/*! X-Framework 30-07-2013 */
!function(a,b){var c=$.fn.hide;$.fn.hide=function(){var a=c.apply(this,arguments);return $(this).trigger("hide"),a};var d=$.fn.show;$.fn.show=function(){var a=d.apply(this,arguments);return $(this).trigger("show"),a};var e=$.fn.html;$.fn.html=function(){var a=e.apply(this,arguments);return $(this).trigger("show"),$(this).trigger("html"),a};var f=$.fn.append;$.fn.append=function(){var a=f.apply(this,arguments);return $(this).trigger("append"),a};var g=$.fn.prepend;$.fn.prepend=function(){var a=g.apply(this,arguments);return $(this).trigger("prepend"),a},_.isFunction($.fn.detach)||($.fn.detach=function(a){return this.remove(a,!0)}),_.isFunction($.fn.wrapInner)||($.fn.wrapInner=function(a){return _.isFunction(a)?this.each(function(b){$(this).wrapInner(a.call(this,b))}):this.each(function(){var b=$(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})});var h=$.fn.detach;$.fn.detach=function(){var a=$(this).parent(),b=h.apply(this,arguments);return a.trigger("detach"),b},XF=a.XF=a.XF||{},XF.start=function(a){a=a||{},XF.Cache=new XF.CacheClass,XF.Controller=new XF.ControllerClass,XF.Device=new XF.DeviceClass,XF.PageSwitcher=new XF.PageSwitcherClass,XF.Settings.bulkSet(a.settings),XF.Cache.init(),a.device=a.device||{},XF.Device.init(a.device.types),a.router=a.router||{},i(a.router),j(),m(),rootDOMObject=a.root,rootDOMObject||(rootDOMObject=$("body")),k(rootDOMObject)},XF.Utils={},XF.Utils.AddressBar={},_.extend(XF.Utils.AddressBar,{isMobile:/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase()),BODY_SCROLL_TOP:!1,getScrollTop:function(){var b=a,c=document;return b.pageYOffset||"CSS1Compat"===c.compatMode&&c.documentElement.scrollTop||c.body.scrollTop||0},hide:function(){console.log("XF :: Utils :: AddressBar :: hide");var b=a;if(location.hash||XF.Utils.AddressBar.BODY_SCROLL_TOP===!1||b.scrollTo(0,1===XF.Utils.AddressBar.BODY_SCROLL_TOP?0:1),this.isMobile){var c=document.documentElement.style;return c.height="200%",c.overflow="visible",a.scrollTo(0,1),c.height=a.innerHeight+"px",!0}},hideOnLoad:function(){console.log("XF :: Utils :: AddressBar :: hideOnLoad");var b=a,c=b.document;!location.hash&&b.addEventListener&&(a.scrollTo(0,1),XF.Utils.AddressBar.BODY_SCROLL_TOP=1,bodycheck=setInterval(function(){c.body&&(clearInterval(bodycheck),XF.Utils.AddressBar.BODY_SCROLL_TOP=XF.Utils.AddressBar.getScrollTop(),XF.Utils.AddressBar.hide())},15),b.addEventListener("load",function(){setTimeout(function(){XF.Utils.AddressBar.getScrollTop()<20&&XF.Utils.AddressBar.hide()},0)}))}});var i=function(a){if(XF.Router)throw"XF.createRouter can be called only ONCE!";XF.Router=new(XF.RouterClass.extend(a))},j=function(){$("[data-href]").live("click",function(){XF.Router.navigate($(this).attr("data-href"),{trigger:!0}),_.delay(function(){a.scrollTo(0,0)},250)})},k=function(a){$(a).find("[data-component][data-cache=true],[data-component]:visible").each(function(a,b){var c=$(b).attr("data-id"),d=$(b).attr("data-component");l(c,d,!0)})},l=function(a,b){q(b,function(c){if(!o[a]){var d=new c(b,a);console.log("XF :: loadChildComponent - created : "+a),o[a]=d,d.construct()}})},m=function(){$("[data-component]").live("show",function(a){if(a.currentTarget==a.target){var b=$(this).attr("data-id");if(!o[b]){var c=$(this).attr("data-component");l(b,c)}XF.UIElements.enhanceView($(this))}})},n=function(a,b){var c=document.createElement("script");c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&(c.onreadystatechange=null,b&&b())}:c.onload=function(){b&&b()},c.src=a,document.getElementsByTagName("head")[0].appendChild(c)},o={},p={},q=function(a,b){var c=p[a];return c||(c=XF.registerComponent(a,XF.Settings.property("componentUrlFormatter")(a))),c.loaded?(b(c.compDef),void 0):(c.callbacks.push(b),c.loading||(c.loading=!0,n(c.compSrc)),void 0)};XF.getComponentByID=function(a){return o[a]},XF.registerComponent=function(a,b){var c=p[a];return c?c:(p[a]=new t(b),p[a])},XF.defineComponent=function(a,b){var c=p[a];for(c||(c=p[a]=new t(null)),p[a].loading=!1,p[a].loaded=!0,p[a].compDef=b;c.callbacks.length;)c.callbacks.pop()(c.compDef)},XF.requireComponent=function(a,b){q(a,b)};var r={};XF.setOptionsByID=function(a,b){r[a]=b};var s=function(a){return r[a]||{}};XF.Events=b.Events,XF.history=b.history,XF.Settings={},_.extend(XF.Settings,{options:{applicationVersion:"1.0.0",noCache:!1,componentUrlPrefix:"",componentUrlPostfix:".js",componentUrlFormatter:function(a){return XF.Settings.property("componentUrlPrefix")+a+XF.Settings.property("componentUrlPostfix")},templateUrlPrefix:"",templateUrlPostfix:".tmpl",templateUrlFormatter:function(a,b){return XF.Settings.property("templateUrlPrefix")+b+a+XF.Settings.property("templateUrlPostfix")},dataUrlPrefix:"",dataUrlPostfix:".json",dataUrlFormatter:function(a){return XF.Settings.property("dataUrlPrefix")+a+XF.Settings.property("dataUrlPostfix")},touchableSwipeLength:100,touchableDoubleTapInterval:700,touchableLongTapInterval:500},bulkSet:function(a){_.extend(this.options,a)},getProperty:function(a){return this.options[a]},setProperty:function(a,b){this.options[a]=b},property:function(a,b){return void 0===b?this.getProperty(a):(this.setProperty(a,b),void 0)}}),XF.Cache=null,XF.CacheClass=function(){this.storage=null,this.available=!1},_.extend(XF.CacheClass.prototype,{init:function(){this.storage=a.localStorage;try{this.storage.setItem("check","check"),this.storage.removeItem("check"),this.available=!0}catch(b){this.available=!1}var c=this.get("applicationVersion");XF.Settings.property("noCache")?(console.log("XF.Cache :: init - cache is disable for the whole app manually - clearing storage"),this.clear(),this.set("applicationVersion",XF.Settings.property("applicationVersion"))):c&&c==XF.Settings.property("applicationVersion")?console.log("XF.Cache :: init - same version is cached - useing it as much as possible"):(console.log("XF.Cache :: init - wrong or no version cached - clearing storage"),this.clear(),this.set("applicationVersion",XF.Settings.property("applicationVersion")))},get:function(a){var b;if(this.available)try{b=this.storage.getItem(a),console.log('XF.Cache :: get - "'+a+'" = "'+b+'"')}catch(c){b=null}else b=null;return b},set:function(a,b){var c;if(this.available)try{this.storage.setItem(a,b),c=!0,console.log('XF.Cache :: set - "'+a+'" = "'+b+'"')}catch(d){c=!1}else c=!1;return c},clear:function(){var a;if(this.available)try{this.storage.clear(),a=!0,console.log("XF.Cache :: clear")}catch(b){a=!1}else a=!1;return a}}),XF.Controller=null,XF.ControllerClass=function(){},_.extend(XF.ControllerClass.prototype,XF.Events),XF.Router=null,XF.RouterClass=b.Router,_.extend(XF.RouterClass.prototype,{start:function(){XF.history.start()},bindAnyRoute:function(a){this.on("all",a),this.mostRecentCalled&&a(this.mostRecentCalled.name)},getRouteByEventName:function(a){return a.replace("route:","")}}),XF.Component=function(a,b){this.name=a||"default_name",this.id=b||"default_id",this.rendered=!1;var c=function(){this.unbind("refresh",c),this.rendered=!0};this.bind("refresh",c);var d=this.options,e=s(this.id);this.options=_.defaults(e,d)},XF.Component.template=null,XF.Component.templateURL=!1,XF.Component.templateLoaded=!1,XF.Component.templateLoading=!1,XF.Component.compiledTemplate=null,_.extend(XF.Component.prototype,XF.Events),_.extend(XF.Component.prototype,{options:{},modelClass:XF.Model,model:null,viewClass:XF.View,view:null,construct:function(){var a=function(){this.view.unbind("construct",a),this.afterConstructView(),this.init(),this.trigger("init"),this.trigger("construct"),XF.Controller.trigger(this.id+":constructed")},b=function(){this.model.unbind("construct",b),this.afterConstructModel(),this.beforeConstructView(),this.constructView(),this.view.bind("construct",a,this),this.view.construct()};this.beforeConstructModel(),this.constructModel(),this.model.bind("construct",b,this),this.model.construct(),this.childComponent=[]},selector:function(){return"[data-id="+this.id+"]"},beforeConstructView:function(){},constructView:function(){this.view&&this.view instanceof XF.View||(this.viewClass?(this.view=new this.viewClass,this.view instanceof XF.View||(this.view=new XF.View)):this.view=new XF.View),this.view.component=this},afterConstructView:function(){},beforeConstructModel:function(){},constructModel:function(){this.model&&this.model instanceof XF.Model||(this.modelClass?(this.model=new this.modelClass,this.model instanceof XF.Model||(this.model=new XF.Model)):this.model=new XF.Model),this.model.component=this},afterConstructModel:function(){},init:function(){this.refresh()},refresh:function(){var a=function(){this.model.unbind("refresh",a),this.view.refresh(),this.trigger("refresh")};this.model.bind("refresh",a,this),this.model.refresh()},ready:function(a){if(this.rendered)a();else{var b=function(){this.unbind("refresh",b),a()};this.bind("refresh",b,this)}}}),XF.Component.extend=b.Model.extend;var t=function(a){this.compSrc=a,this.compDef=null,this.loading=!1,this.loaded=!1,this.callbacks=[]};return XF.Model=b.Model.extend({component:null,rawData:null,dataURL:null,dataRequestSettings:null,isEmptyData:!1,isStaticData:!1,isStringData:!1,autoUpdateInterval:0,updateInBackground:!1,updateOnShow:!1,defaults:null,construct:function(){if(this.initialize(),this.trigger("init"),this.autoUpdateInterval>0){var a=_.bind(function(){$(this.component.selector()).is(":visible")?this.refresh():this.updateInBackground&&this.refresh()},this);setInterval(a,this.autoUpdateInterval)}this.updateOnShow&&$(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.trigger("construct")},refresh:function(){var a=function(){this.unbind("dataLoaded",a),this.component.view.renderVersion,this.afterLoadData(),this.trigger("refresh")};this.bind("dataLoaded",a),this.beforeLoadData(),this.loadData()},getDataURL:function(){if(!this.dataURL){if(!this.component)throw'XF.Model "component" linkage lost';this.dataURL=_.bind(XF.Settings.property("dataUrlFormatter"),this)(this.component.name)}return this.dataURL},getDataRequestSettings:function(){return this.dataRequestSettings||{}},beforeLoadData:function(){},loadData:function(){if(this.isEmptyData||this.rawData&&this.isStaticData&&!(this.autoUpdate>0))this.trigger("dataLoaded");else{var a=this,b=this.getDataURL();$.ajax(_.extend(this.getDataRequestSettings(),{url:b,complete:function(b,c){if(!a.component)throw'XF.Model "component" linkage lost';a.rawData="success"==c?a.isStringData?b.responseText:JSON.parse(b.responseText):a.isStringData?{}:"",a.trigger("dataLoaded")}}))}},afterLoadData:function(){}}),XF.View=b.View.extend({component:null,templateURL:null,ignoreModelUpdate:!1,updateOnShow:!1,useCache:!1,construct:function(){var a=function(){return this.loadTemplateFailed?(this.unbind("templateLoaded",a),this.afterLoadTemplateFailed(),void 0):this.component.constructor.templateLoaded?(this.unbind("templateLoaded",a),this.afterLoadTemplate(),this.initialize(),this.trigger("init"),this.ignoreModelUpdate||this.component.model.bind("changed",this.refresh,this),this.updateOnShow&&$(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.trigger("construct"),void 0):(this.loadTemplate(),void 0)};this.bind("templateLoaded",a),this.beforeLoadTemplate(),this.loadTemplate()},lastDeviceType:null,getTemplateURL:function(){if(this.lastDeviceType&&(this.templateURL=null),!this.templateURL){if(!this.component)throw'XF.View "component" linkage lost';if(this.lastDeviceType=XF.Device.getNextType(this.lastDeviceType),!this.lastDeviceType)return null;var a="";this.lastDeviceType&&this.lastDeviceType.templatePath&&(a=this.lastDeviceType.templatePath),this.templateURL=XF.Settings.property("templateUrlFormatter")(this.component.name,a)}return this.templateURL},getMarkup:function(){return this.component.constructor.compiledTemplate||(this.component.constructor.compiledTemplate=_.template(this.component.constructor.template)),this.component.constructor.compiledTemplate(this.component.model)},beforeLoadTemplate:function(){},loadTemplateFailed:!1,loadTemplate:function(){var a=this.getTemplateURL();if(null==a)return this.loadTemplateFailed=!0,this.trigger("templateLoaded"),void 0;if(this.useCache){var b=XF.Cache.get(a);if(b)return this.component.constructor.template=b,this.component.constructor.templateLoaded=!0,this.trigger("templateLoaded"),void 0}if(this.component.constructor.templateLoaded||this.component.constructor.templateLoading)if(this.component.constructor.templateLoading){var c=this;a=this.component.constructor.templateURL;var d=function(b){b.url==a&&(XF.Controller.unbind("templateLoaded",d),c.trigger("templateLoaded"))};XF.Controller.bind("templateLoaded",d)}else this.trigger("templateLoaded");else{this.component.constructor.templateURL=a,this.component.constructor.templateLoading=!0;var c=this;$.ajax({url:a,complete:function(b,d){if(!c.component)throw'XF.View "component" linkage lost';if("success"==d){var e=b.responseText;c.useCache&&XF.Cache.set(a,e),c.component.constructor.template=b.responseText,c.component.constructor.templateLoading=!1,c.component.constructor.templateLoaded=!0,c.trigger("templateLoaded"),XF.Controller.trigger("templateLoaded",{url:a,template:e})}else c.component.constructor.template=null,c.component.constructor.templateLoading=!1,c.component.constructor.templateLoaded=!1,c.trigger("templateLoaded"),XF.Controller.trigger("templateLoaded",{url:a,template:null})}})}},afterLoadTemplate:function(){},afterLoadTemplateFailed:function(){console.log('XF.View :: afterLoadTemplateFailed - could not load template for "'+this.component.id+'"'),console.log("XF.View :: afterLoadTemplateFailed - @dev: verify XF.Device.types settings & XF.View :: getTemplate URL overrides")},refresh:function(){this.preRender(),this.render(),this.postRender(),this.trigger("refresh")},preRender:function(){},renderVersion:0,render:function(){this.renderVersion++;var a=$("[data-id="+this.component.id+"]");a.html(this.getMarkup()),k(a)},postRender:function(){}}),XF.RootComponentInstance=null,XF.RootComponent=XF.Component.extend({beforeStart:function(){},start:function(){XF.Router.start(),XF.PageSwitcher.start()},afterStart:function(){},constructor:function(){if(XF.RootComponentInstance)throw"XF.RootComponent can be only ONE!";XF.RootComponentInstance=this,this.ready(function(){XF.RootComponentInstance.beforeStart(),XF.RootComponentInstance.start(),XF.RootComponentInstance.afterStart()}),XF.Component.apply(this,arguments)}}),XF.PageSwitcher=null,XF.PageSwitcherClass=function(){},_.extend(XF.PageSwitcherClass.prototype,{pageClass:"xf-page",activePageClass:"xf-page-active",animationType:"fade",activePage:null,start:function(){$.fn.animationComplete=function(b){return"WebKitTransitionEvent"in a||"transitionEvent"in a?$(this).one("webkitAnimationEnd animationend",b):(setTimeout(b,0),$(this))};var b=$(XF.RootComponentInstance.selector()+" ."+this.pageClass);if(b.length){var c=b.filter("."+this.activePageClass);c.length?this.activePage=c:this.switchToPage(b.first()),XF.Router.bindAnyRoute(this.routeHandler)}},routeHandler:function(a){var b=XF.Router.getRouteByEventName(a),c=$("."+XF.PageSwitcher.pageClass+"#"+b);c.length&&XF.PageSwitcher.switchToPage(c)},switchToPage:function(b){if(!this.activePage||b.attr("id")!=this.activePage.attr("id")){var c=XF.Device.getViewport(),d=XF.Device.getScreenHeight(),e=this.animationType,f=this.activePageClass,g=this.activePage,h=b;this.activePage=h,g?(c.addClass("xf-viewport-transitioning"),g.height(d+$(a).scrollTop()).addClass("out "+e),h.height(d+$(a).scrollTop()).addClass("in "+e+" "+f),g.animationComplete(function(){g.height("").removeClass(e+" out in reverse"),g.attr("id")!=XF.PageSwitcher.activePage.attr("id")&&g.removeClass(f)}),h.animationComplete(function(){h.height("").removeClass(e+" out in reverse"),c.removeClass("xf-viewport-transitioning")})):this.activePage.addClass(f),a.scrollTo(0,1),k(this.activePage[0])}}}),XF.Device=null,XF.DeviceClass=function(){this.size={width:0,height:0},this.types=[{name:"desktop",range:{max:null,min:1024},templatePath:"desktop/",fallBackTo:"tablet"},{name:"tablet",range:{max:1024,min:480},templatePath:"tablet/",fallBackTo:"mobile"},{name:"mobile",range:{max:480,min:null},templatePath:"mobile/",fallBackTo:"default"}],this.defaultType={name:"default",range:{min:null,max:null},templatePath:"",fallBackTo:null},this.type=this.defaultType,this.isTouchable=!1},_.extend(XF.DeviceClass.prototype,{init:function(a){this.types=a||this.types,this.detectType(),this.detectTouchable()},detectType:function(){this.size.width=$(a).width(),this.size.height=$(a).height(),console.log('XF.DeviceClass :: detectType - width = "'+this.size.width+'"'),console.log('XF.DeviceClass :: detectType - height = "'+this.size.height+'"');var b=Math.max(this.size.width,this.size.height);console.log('XF.DeviceClass :: detectType - maxSide = "'+b+'"');var c=null;_.each(this.types,function(a){try{(!a.range.min||a.range.min&&b>a.range.min)&&(!a.range.max||a.range.max&&b<a.range.max)&&(c=a)}catch(d){console.log("XF.DeviceClass :: detectType - bad type detected - skipping"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")}}),c?this.type=c:(this.type=this.defaultType,console.log("XF.DeviceClass :: detectType - could not choose any of device type"),console.log("XF.DeviceClass :: detectType - drop back to this.defaultType"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")),console.log('XF.DeviceClass :: detectType - selected type "'+this.type.name+'"')},getNextType:function(a){var b=this.type;return a&&(b=a.fallBackTo?this.getTypeByName(a.fallBackTo):this.defaultType),b&&b.templatePath||(b=this.defaultType),b==a?(console.log("XF.DeviceClass :: getNextType - infinit cycle of drop down logic detected"),console.log("XF.DeviceClass :: getNextType - stop trying, no template is available"),null):b},getTypeByName:function(a){var b=null;return _.each(this.types,function(c){try{c.name==a&&(b=c)}catch(d){console.log("XF.DeviceClass :: getTypeByName - bad type name - skipping"),console.log("XF.DeviceClass :: getTypeByName - @dev: plz verify types list")}}),b},detectTouchable:function(){var b=" -webkit- -moz- -o- -ms- ".split(" "),c=["@media (",b.join("touch-enabled),("),"app_device_test",")","{#touch{top:9px;position:absolute}}"].join(""),d=this;this.injectElementWithStyles(c,function(b){var c=document.styleSheets[document.styleSheets.length-1],e=(c?c.cssRules&&c.cssRules[0]?c.cssRules[0].cssText:c.cssText||"":"",b.childNodes),f=e[0];d.isTouchable="ontouchstart"in a||a.DocumentTouch&&document instanceof DocumentTouch||9===(f&&f.offsetTop)},1,["touch"]),console.log("XF.Device :: detectTouchable - device IS "+(this.isTouchable?"":"NOT ")+"touchable")},injectElementWithStyles:function(a,b,c,d){var e,f,g,h=document.createElement("div"),i=document.body,j=i?i:document.createElement("body");if(parseInt(c,10))for(;c--;)g=document.createElement("div"),g.id=d?d[c]:"app_device_test"+(c+1),h.appendChild(g);return e=["&#173;","<style>",a,"</style>"].join(""),h.id="app_device_test",j.innerHTML+=e,j.appendChild(h),i||(j.style.background="",docElement.appendChild(j)),f=b(h,a),i?h.parentNode.removeChild(h):j.parentNode.removeChild(j),!!f},ORIENTATION_PORTRAIT:"portrait",ORIENTATION_LANDSCAPE:"landscape",getOrientation:function(){var a=!0,b=document.documentElement;return void 0!==$.support||(a=b&&b.clientWidth/b.clientHeight<1.1),a?this.ORIENTATION_PORTRAIT:this.ORIENTATION_LANDSCAPE},getScreenHeight:function(){var b=this.getOrientation(),c=b===this.ORIENTATION_PORTRAIT,d=c?480:320,e=c?screen.availHeight:screen.availWidth,f=Math.max(d,$(a).height()),g=Math.min(e,f);return g},getViewport:function(){var a=$("body").addClass("xf-viewport");return a[0]||(a=$(".xf-page").eq(0),a=a.length?a.parent():$("body"),a.addClass("xf-viewport")),a.eq(0)}}),XF.trace=function(a){$("#tracer").html(a+"<br/>"+$("#tracer").html())},a.XF=XF}.call(this,window,Backbone),function(){$.fn.touchable=function(a){return this.each(function(){return $(this).data("touchable")||$(this).data("touchable",new XF.Touchable(this,a)),$(this).data("touchable")})},XF.TouchGesture=function(a,b,c){this.touchable=a,this.fingerID=b,this.startPosition=c,this.currentPosition=c,this.previousPosition=c,this.previousDelta={x:0,y:0},this.startDelta={x:0,y:0},this.swipeAngle=0,this.swipeLength=0,this.swipeDirection=XF.TouchGesture.SWIPE_DIRECTION_LEFT,this.longTouchHandler=_.bind(this.longTouchHandlerF,this),this.longTouchTimeout=setTimeout(this.longTouchHandler,this.touchable.options.longTapInterval),this.longTouchDispatched=!1,this.gestureComplete=!1,this.dispatch(XF.TouchGesture.TOUCH_START_EVENT)},_.extend(XF.TouchGesture.prototype,{move:function(a){this.previousPosition=this.currentPosition,this.currentPosition=a,this.previousDelta.x=this.currentPosition.x-this.previousPosition.x,this.previousDelta.y=this.currentPosition.y-this.previousPosition.y,this.startDelta.x=this.currentPosition.x-this.startPosition.x,this.startDelta.y=this.currentPosition.y-this.startPosition.y,this.checkSwipe(),this.dispatch(XF.TouchGesture.TOUCH_MOVE_EVENT)},checkSwipe:function(){if(this.swipeLength=Math.round(Math.sqrt(Math.pow(this.startDelta.x,2)+Math.pow(this.startDelta.y,2))),this.swipeLength>this.touchable.options.swipeLength){var a=Math.atan2(this.startDelta.y,this.startDelta.x);this.swipeAngle=Math.round(180*a/Math.PI),this.swipeAngle<0&&(this.swipeAngle=360-Math.abs(this.swipeAngle)),this.swipeDirection=this.swipeAngle<=45&&this.swipeAngle>=0?XF.TouchGesture.SWIPE_DIRECTION_RIGHT:this.swipeAngle<=360&&this.swipeAngle>=315?XF.TouchGesture.SWIPE_DIRECTION_RIGHT:this.swipeAngle>=135&&this.swipeAngle<=225?XF.TouchGesture.SWIPE_DIRECTION_LEFT:this.swipeAngle>45&&this.swipeAngle<135?XF.TouchGesture.SWIPE_DIRECTION_DOWN:XF.TouchGesture.SWIPE_DIRECTION_UP,this.dispatch(XF.TouchGesture.SWIPE_EVENT),this.touchable.destroyGesture(this.fingerID)}},longTouchHandlerF:function(){this.dispatch(XF.TouchGesture.LONG_TAP_EVENT),this.longTouchDispatched=!0},release:function(){this.gestureComplete||this.longTouchDispatched||(clearTimeout(this.longTouchTimeout),this.dispatch(XF.TouchGesture.TAP_EVENT),this.touchable.lastTapTimestamp+this.touchable.options.doubleTapInterval>XF.TouchGesture.getTimeStamp()?(this.dispatch(XF.TouchGesture.DOUBLE_TAP_EVENT),this.touchable.lastTapTimestamp=0):this.touchable.lastTapTimestamp=XF.TouchGesture.getTimeStamp()),this.gestureComplete=!0,this.dispatch(XF.TouchGesture.TOUCH_END_EVENT),this.touchable.destroyGesture(this.fingerID)},dispatch:function(a){console.log("XF.TouchGesture :: dispatch - "+a+" ("+this.fingerID+")"),$(this.touchable.elem).trigger(a,this)}}),_.extend(XF.TouchGesture,{TOUCH_START_EVENT:"TOUCH_START",TOUCH_MOVE_EVENT:"TOUCH_MOVE",TOUCH_END_EVENT:"TOUCH_END",TAP_EVENT:"TAP",SWIPE_EVENT:"SWIPE",LONG_TAP_EVENT:"LONG_TAP",DOUBLE_TAP_EVENT:"DOUBLE_TAP",SWIPE_DIRECTION_LEFT:"LEFT",SWIPE_DIRECTION_RIGHT:"RIGHT",SWIPE_DIRECTION_UP:"UP",SWIPE_DIRECTION_DOWN:"DOWN",getTimeStamp:function(){return(new Date).getTime()}}),XF.Touchable=function(a,b){this.elem=a,this.$elem=$(a),this.options=b?_.clone(b):{},_.defaults(this.options,{swipeLength:XF.Settings.property("touchableSwipeLength"),doubleTapInterval:XF.Settings.property("touchableDoubleTapInterval"),longTapInterval:XF.Settings.property("touchableLongTapInterval")}),this.gestures={},this.lastTapTimestamp=0,this.touchstart=_.bind(this.touchstartF,this),this.touchmove=_.bind(this.touchmoveF,this),this.touchend=_.bind(this.touchendF,this),XF.Device.isTouchable?$(a).bind("touchstart",this.touchstart):$(a).bind("mousedown",this.touchstart)},_.extend(XF.Touchable.prototype,{getGestureByID:function(a){return this.gestures[a]},createGesture:function(a,b){return this.gestures[a]=new XF.TouchGesture(this,a,b)},destroyGesture:function(a){delete this.gestures[a],0==_.size(this.gestures)&&(XF.Device.isTouchable?($(document).unbind("touchmove",this.touchmove),$(document).unbind("touchend",this.touchend)):($(document).unbind("mousemove",this.touchmove),$(document).unbind("mouseup",this.touchend)))},touchstartF:function(a){if(a=a.originalEvent||a,void 0!=a.changedTouches){var b=this;_.each(a.changedTouches,function(a){b.createGesture(a.identifier,{x:a.clientX,y:a.clientY})}),$(document).bind("touchmove",this.touchmove),$(document).bind("touchend",this.touchend)}else this.createGesture("mouse",{x:a.pageX,y:a.pageY}),$(document).bind("mousemove",this.touchmove),$(document).bind("mouseup",this.touchend)},touchmoveF:function(a){if(a=a.originalEvent||a,void 0!=a.changedTouches){var b=this;_.each(a.changedTouches,function(a){var c=b.getGestureByID(a.identifier);c&&c.move({x:a.clientX,y:a.clientY})})}else{var c=this.getGestureByID("mouse");c&&c.move({x:a.pageX,y:a.pageY})}},touchendF:function(a){if(a=a.originalEvent||a,"undefined"!=typeof a.changedTouches){var b=this;_.each(a.changedTouches,function(a){var c=b.getGestureByID(a.identifier);c&&c.release()})}else{var c=this.getGestureByID("mouse");c&&c.release()}}})}.call(this,window,Backbone),function(){$.fn.outerHtml=function(a){if(a)return this.each(function(){$(this).replaceWith(a)});var b=$("<div></div>").append($(this).clone()),c=b.html();return b.remove(),c}}.call(this,window,Backbone),function(){XF.UIElements={},_.extend(XF.UIElements,{enhanceView:function(a){!a instanceof $&&(a=$(a),!a instanceof $)||_.each(XF.UIElements.enhancementList,function(b){a.find(b.selector).not("[data-skip-enhance=true]").each(function(){var a=!1;_.each(XF.UIElements.enhanced.length,function(){XF.UIElements.enhanced[i]===this&&(a=!0)}),!a&"true"!=$(this).attr("data-skip-enhance")&&(XF.UIElements.enhanced.push(this),XF.UIElements[b.enhanceMethod](this))})})},enhancementList:{},enhanced:[]})}.call(this,window,Backbone),function(){XF.UIElements.enhancementList.button={selector:"A[data-role=button], BUTTON, INPUT[type=submit], INPUT[type=reset], INPUT[type=button] [data-appearance=backbtn]",enhanceMethod:"enhanceButton"},XF.UIElements.enhanceButton=function(a){var b=$(a);if(a&&!(!b instanceof $)&&"true"!=b.attr("data-skip-enhance")){var c,d;if("A"==a.nodeName||"BUTTON"==a.nodeName)c=b.attr({"data-skip-enhance":!0}),d=b.html(),b.html("");else{if("INPUT"!=a.nodeName)return;c=$("<div></div>").append(b.clone().addClass("xf-input-hidden").attr({"data-skip-enhance":!0})),b.outerHtml(c),d=b.attr("value")}var e="true"==b.attr("data-small")||"backbtn"==b.attr("data-appearance");c.addClass(e?"xf-button-small":"xf-button"),"backbtn"==b.attr("data-appearance")&&c.addClass("xf-button-back");var f=b.attr("data-icon");if("backbtn"==b.attr("data-appearance")&&(f="left"),f){var g=$("<span class=xf-icon></span>");g.addClass("xf-icon-"+f),e?g.addClass("xf-icon-small"):g.addClass("xf-icon-big");var h=b.attr("data-iconpos")||"left";"left"!=h&&"right"!=h&&"top"!=h&&"bottom"!=h&&(h="left"),c.addClass("xf-iconpos-"+h),c.append(g)}if(d){var i=$("<span></span>").append(d);e||"backbtn"==b.attr("data-appearance")?i.addClass("xf-button-small-text"):i.addClass("xf-button-text"),c.append(i)}"true"==b.attr("data-special")&&c.addClass("xf-button-special"),"true"==b.attr("data-alert")&&c.addClass("xf-button-alert"),"true"==b.attr("data-alert")&&c.addClass("xf-button-alert")}},XF.UIElements.createButton=function(a){var b=$("<button></button>");b.html(a.text);var c={};return a.icon&&""!=a.icon&&(c["data-icon"]=a.icon),a.iconpos&&""!=a.iconpos&&(c["data-iconpos"]=a.iconpos),a.small&&""!=a.small&&(c["data-small"]=a.small),a.appearance&&""!=a.appearance&&(c["data-appearance"]=a.appearance),a.special&&""!=a.special&&(c["data-special"]=a.special),a.alert&&""!=a.alert&&(c["data-alert"]=a.alert),_.isFunction(a.handler)&&b.click(a.handler),b.attr(c),XF.UIElements.enhanceButton(b[0]),b}}.call(this,window,Backbone),function(){XF.UIElements.enhancementList.checkboxRadio={selector:"INPUT[type=checkbox], INPUT[type=radio]",enhanceMethod:"enhanceCheckboxRadio"},XF.UIElements.enhanceCheckboxRadio=function(a){var b=$(a);if(a&&!(!b instanceof $)&&"true"!=b.attr("data-skip-enhance")){b.attr({"data-skip-enhance":!0});var c=b.attr("id"),d=$("label[for="+c+"]");if(d.length){var e=b.attr("type").toLowerCase(),f="switch"==b.attr("data-role"),g=$("<div></div>");f?(g.addClass("xf-switch"),g.append($('<label class="xf-switch-control"></label>').attr({"for":c}).append(b.clone()).append($("<span class=xf-switch-track><span class=xf-switch-track-wrap><span class=xf-switch-thumb></span></span></span>"))),g.append(d.addClass("xf-switch-label"))):(g.addClass("xf-input-"+e),g.append($('<label class="xf-input-positioner"></label>').attr({"for":c}).append(b.clone())),g.append(d.addClass("xf-input-label"))),b.outerHtml(g)}}}}.call(this,window,Backbone),function(){XF.UIElements.enhancementList.fieldset={selector:"fieldset[data-role=controlgroup]",enhanceMethod:"enhanceFieldset"},XF.UIElements.enhanceFieldset=function(a){var b=$(a);if(a&&!(!b instanceof $)&&"true"!=b.attr("data-skip-enhance")){b.attr({"data-skip-enhance":!0}),b.addClass("xf-controlgroup");var c=b.children("legend").detach();if(b.wrapInner("<div class=xf-controlgroup-controls>"),b.prepend(c),c.length){var d=$("<div></div>"),e={};_.each(c[0].attributes,function(a){e[a.name]=a.value}),d.attr(e),d.addClass("xf-label"),d.html(c.html()),c.outerHtml(d.outerHtml())}}}}.call(this,window,Backbone),function(){XF.UIElements.enhancementList.list={selector:"UL[data-role=listview], OL[data-role=listview]",enhanceMethod:"enhanceList"},XF.UIElements.enhanceList=function(a){var b=$(a);if(a&&!(!b instanceof $)&&"true"!=b.attr("data-skip-enhance")){b.attr({"data-skip-enhance":!0}),b.addClass("xf-listview"),"true"==b.attr("data-fullwidth")&&b.addClass("xf-listview-fullwidth"),b.children("li").addClass("xf-li"),b.children("li[data-role=divider]").addClass("xf-li-divider");var c=b.children("li"),d=c.children("a");d.addClass("xf-li-btn"),c.not(d.parent()).not("[data-role=divider]").addClass("xf-li-static"),b.children("li[data-icon]").children("a").each(function(){var a=$(this),b=a.parent().attr("data-icon");a.append($("<span></span>").addClass("xf-icon xf-icon-big xf-icon-"+b));var c=a.parent().attr("data-iconpos");"left"!=c&&"right"!=c&&(c="right"),a.addClass("xf-li-with-icon-"+c)}),d.children(".xf-count-bubble").parent().addClass("xf-li-has-count"),d.children("img").parent().each(function(){var a=$(this),b=a.parent().attr("data-thumbpos");"right"!=b&&"left"!=b&&(b="left"),a.addClass("xf-li-with-thumb-"+b),a.children("img").addClass("xf-li-thumb xf-li-thumb-"+b)}),d.each(function(){var a=$(this);a.append($("<div class=xf-btn-text></div>").append(a.children().not(".xf-icon, .xf-count-bubble, .xf-li-thumb")))}),c.find("h1, h2, h3, h4, h5, h6").addClass("xf-li-header"),c.find("p").addClass("xf-li-desc"),c.filter(".xf-li-static").each(function(){$(this).wrapInner("<div class=xf-li-wrap />")})}}}.call(this,window,Backbone),function(){XF.UIElements.createPopup=function(){var a=$('<div class="xf-dialog "><div class="xf-dialog-content"></div></div>');return a},XF.UIElements.showDialog=function(a,b,c){var d=XF.UIElements.createDialog(a,b,c);XF.UIElements.showPopup(d)},XF.UIElements.showPopup=function(a){XF.Device.getViewport().append(a)},XF.UIElements.hidePopup=function(a){a.detach()},XF.UIElements.createDialog=function(a,b,c){var d=XF.UIElements.createPopup();d.find(".xf-dialog-content").append($("<div></div>").addClass("xf-dialog-box").append($("<div></div>").addClass("xf-dialog-box-header").append($("<h3></h3>").html(a))).append($("<div></div>").addClass("xf-dialog-box-content").html(b)).append($("<div></div>").addClass("xf-dialog-box-footer clearfix")));var e=d.find(".xf-dialog-box-footer");if(c||(c=[{text:"OK",handler:function(){XF.UIElements.hidePopup(d)}}]),c){var f,g=c.length;_.each(c,function(a){f=a instanceof $?a:XF.UIElements.createButton(a),e.append($("<div></div>").addClass("xf-grid-unit xf-grid-unit-1of"+g).append(f))})}return XF.UIElements.dialog=d,d},XF.UIElements.createNotification=function(a,b){var c=XF.UIElements.createPopup().addClass("xf-dialog-notification");
return c.find(".xf-dialog-content").append($("<div></div>").addClass("xf-notification").append($("<div></div>").addClass("xf-notification-wrap").append($("<div></div>").addClass("xf-notification-text").html(a)))),b&&""!=b&&c.find(".xf-notification-wrap").prepend($("<div></div>").addClass("xf-notification-icon").append($("<span></span>").addClass("xf-icon xf-icon-xl xf-icon-"+b))),c},XF.UIElements.loadingNotification=null,XF.UIElements.dialog=null,XF.UIElements.setLoadingNotification=function(a){XF.UIElements.loadingNotification=a},XF.UIElements.showLoading=function(a,b){(a||b)&&(XF.UIElements.loadingNotification&&XF.UIElements.hideLoading(),XF.UIElements.setLoadingNotification(XF.UIElements.createNotification(a,b))),XF.UIElements.loadingNotification||XF.UIElements.setLoadingNotification(XF.UIElements.createNotification("Loading...")),XF.UIElements.showPopup(XF.UIElements.loadingNotification)},XF.UIElements.hideLoading=function(){XF.UIElements.loadingNotification&&XF.UIElements.hidePopup(XF.UIElements.loadingNotification)},XF.UIElements.hideDialog=function(){XF.UIElements.dialog&&XF.UIElements.hidePopup(XF.UIElements.dialog)}}.call(this,window,Backbone),function(){XF.UIElements.enhancementList.scrollable={selector:"[data-scrollable=true]",enhanceMethod:"enhanceScrollable"},XF.UIElements.enhanceScrollable=function(a){var b=$(a);if(a&&!(!b instanceof $)&&"true"!=b.attr("data-skip-enhance")){b.attr({"data-skip-enhance":!0});var c=b.children();b.append($("<div></div>").addClass("xf-scrollable-content").append(c));var d=b.attr("id");d&&""!=d||(d="xf_scrollable_"+(new Date).getTime(),b.attr({id:d}));var e=b.data("iscroll",new iScroll(d)),f=!1,g=function(){f&&(f=!1,e.data("iscroll").refresh(),i())},h=function(){$.contains($("#"+d)[0],this)&&(f=!0,setTimeout(g,100))},i=function(){$("#"+d+" *").bind("detach",h).bind("hide",h).bind("show",h).bind("append",h).bind("prepend",h).bind("html",h).bind("resize",h)};i()}}}.call(this,window,Backbone),function(){XF.UIElements.enhancementList.textinput={selector:"INPUT[type=text], INPUT[type=search], INPUT[type=tel], INPUT[type=url], INPUT[type=email], INPUT[type=password], INPUT[type=datetime], INPUT[type=date], INPUT[type=month], INPUT[type=week], INPUT[type=time], INPUT[type=datetime-local], INPUT[type=number], INPUT[type=color], TEXTAREA, INPUT[type=range], INPUT[type=search]",enhanceMethod:"enhanceTextInput"},XF.UIElements.enhanceTextInput=function(a){var b=$(a);if(a&&!(!b instanceof $)&&"true"!=b.attr("data-skip-enhance")){b.attr({"data-skip-enhance":!0}),b.addClass("xf-input-text");var c="INPUT"==a.nodeName,d=b.attr("type");if("search"==d){var e=$('<input type="text"/>'),f={};_.each(a.attributes,function(a){"type"!=a.name&&(f[a.name]=a.value)}),e.attr(f),b.outerHtml(e),b=e,a=e[0]}else if("number"==d||"range"==d){var g=b.attr("min"),h=b.attr("max"),i=parseFloat(b.attr("value")),j=parseFloat(b.attr("step"))||1,e=$('<input type="text"/>'),f={};_.each(a.attributes,function(a){"type"!=a.name&&(f[a.name]=a.value)}),e.attr(f),e.attr({"data-skip-enhance":!0});var k=$("<div></div>").addClass("xf-input-number");k.append($('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-decrease").attr({"data-skip-enhance":!0}).append($("<span></span>").addClass("xf-icon xf-icon-big xf-icon-minus-circled"))),k.append(e),k.append($('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-increase").attr({"data-skip-enhance":!0}).append($("<span></span>").addClass("xf-icon xf-icon-big xf-icon-plus-circled")));var l=null;if("number"==d)b.outerHtml(k),b=k,a=k[0];else if("range"==d&&(l=$("<div></div>").addClass("xf-range"),l.append(k),(g||0===g)&&(h||0===h))){g=parseFloat(g),h=parseFloat(h);var m=100*(i-g)/(h-g);l.append($("<div></div>").addClass("xf-input-range").append($("<div></div>").addClass("xf-range-wrap").append($("<div></div>").addClass("xf-input-range-min").html(g)).append($("<div></div>").addClass("xf-input-range-slider").append($("<div></div>").addClass("xf-input-range-track").append($("<div></div>").addClass("xf-input-range-value").css({width:""+m+"%"}).append($("<div></div>").addClass("xf-input-range-control").attr({tabindex:"0"}).append($("<div></div>").addClass("xf-input-range-thumb").attr({title:""+i}).css({left:"100%"})))))).append($("<div></div>").addClass("xf-input-range-max").html(h)))).append($("<div></div>").addClass("xf-slider")),b.outerHtml(l),b=l,a=l[0]}var n=function(a){var b=a%j,c=a-b;if(b>j/2&&(c+=j),a=c,(h||0===h)&&a>h&&(a=h),(g||0===g)&&g>a&&(a=g),i=a,e.attr({value:a}),l){l.find("div.xf-input-range-thumb").attr({title:a});var d=100*(a-g)/(h-g);l.find("div.xf-input-range-value").css({width:""+d+"%"})}},o=function(){var a=parseFloat(e.attr("value"));a+=j,n(a)},p=function(){var a=parseFloat(e.attr("value"));a-=j,n(a)};k.find("button.xf-input-number-control-decrease").click(p),k.find("button.xf-input-number-control-increase").click(o);var q,r=e.attr("value"),s=function(){q=e.attr("value"),r!=q&&(q=parseFloat(q),isNaN(q)&&(q=g),r=q,n(q))};if(e.change(s).focus(s).focusout(s),l){var t,u,v,w,x,y=void 0,z=function(a){return y||(y=l.find("div.xf-input-range-track")[0].clientWidth),a/y*(h-g)},A=function(a){return z(a)+g},B=function(){v=event.pageX||event.clientX||layerX||event.screenX,t=i,$(document).bind("mouseup",D),$(document).bind("mousemove",C)},C=function(){w=event.pageX||event.clientX||layerX||event.screenX,x=w-v,u=z(x),v=w,t+=u,n(t)},D=function(){$(document).unbind("mouseup",D),$(document).unbind("mousemove",C)},E=function(){$(document).bind("keydown",F)},F=function(a){switch(a.keyCode){case 33:n(i+3*j);break;case 34:n(i-3*j);break;case 35:n(h);break;case 36:n(g);break;case 38:case 39:n(i+j);break;case 37:case 40:n(i-j)}},G=function(){$(document).unbind("keydown",F)};l.find("div.xf-input-range-thumb").bind("mousedown",B),l.find("div.xf-input-range-control").bind("focus",E).bind("focusout",G);var H=function(a){a.target!=l.find("div.xf-input-range-thumb")[0]&&n(A(a.offsetX))};l.find("div.xf-input-range-track").bind("click",H)}}var I=!1;if("split"==b.attr("data-appearance")&&c){var J=["text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","color"];_.each(J,function(a){d==a&&(I=!0)})}var K=b.attr("id"),L=K.length?$("label[for="+K+"]"):[];if(L.length)if(I){b.removeClass("xf-input-text").addClass("xf-input-split-input"),L.addClass("xf-input-split-label");var M=$("<div></div>").addClass("xf-input-split");M.append($("<div></div>").addClass("xf-grid-unit xf-input-split-part1").append(L)),M.append($("<div></div>").addClass("xf-grid-unit xf-input-split-part2").append(b.clone())),b.outerHtml(M),b=M,a=M[0]}else L.addClass("xf-label")}}}.call(this,window,Backbone);